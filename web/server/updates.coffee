#comment here

# AMAZON_TOP_MAP = {
#   # NEEDS MOVIES / INSTANT

#   # NEED MUSIC

#   # APPS DON'T WORK
#   'Apps & Games': 'Music & Media',

#   'Kindle E-readers & Books': 'Music & Media',
#   'Kindle Store': 'Music & Media',

#   'Fire Tablets': 'Electronics',
#   'Fire TV': 'Electronics',
#   'Fire Phone': 'Electronics',

#   'Books & Audible': 'Music & Media',
#   'Books': 'Music & Media',
#   'Magazine Subscriptions', 'Music & Media',

#   'Movies, Music & Games': 'Music & Media',
#   'Movies & TV': 'Music & Media',
#   'Blu-ray': 'Music & Media',
#   'Amazon Instant Video': 'Music & Media',
#   'CDs & Vinyl': 'Music & Media',
#   'Digital Music': 'Music & Media',
#   'Musical Instruments': 'Music & Media',
#   'Video Games': 'Music & Media',

#   'Electronics & Computers': 'Electronics',
#   'Electronics': 'Electronics',
#   'TV & Video': 'Electronics',
#   'Home Audio & Theater': 'Electronics',
#   'Camera, Photo & Video': 'Electronics',
#   'Cell Phones & Accessories': 'Electronics',
#   'Video Games': 'Electronics',
#   'Portable Audio & Accessories': 'Electronics',
#   'Car Electronics & GPS': 'Electronics',
#   'Musical Instruments': 'Electronics',
#   'Electronics Accessories': 'Electronics',
#   'Wearable Technology': 'Electronics',
#   'Laptops & Tablets': 'Electronics',
#   'Desktops & Monitors': 'Electronics',
#   'Computer Accessories & Peripherals': 'Electronics',
#   'Computer Parts & Components': 'Electronics',
#   'Software': 'Electronics',
#   'Printers & Ink': 'Electronics',
#   'Office & School Supplies': 'Electronics',

#   'Home, Garden & Tools': 'Home & Office',
#   'Home': 'Home & Office',
#   'Kitchen & Dining': 'Home & Office',
#   'Furniture & Décor': 'Home & Office',
#   'Bedding & Bath': 'Home & Office',
#   'Appliances': 'Home & Office',
#   'Patio, Lawn & Garden': 'Home & Office',
#   'Fine Art': 'Home & Office',
#   'Arts, Crafts & Sewing': 'Home & Office',
#   'Pet Supplies': 'Home & Office',
#   'Wedding Registry': 'Home & Office',
#   'Home Improvement': 'Home & Office',
#   'Power & Hand Tools': 'Home & Office',
#   'Lamps & Light Fixtures': 'Home & Office',
#   'Kitchen & Bath Fixtures': 'Home & Office',
#   'Hardware': 'Home & Office',
#   'Home Automation': 'Home & Office',

#   'Beauty, Health & Grocery': 'Food & Health',
#   'All Beauty': 'Food & Health',
#   'Luxury Beauty': 'Food & Health',
#   'Men’s Grooming': 'Food & Health',
#   'Health, Household & Baby Care': 'Food & Health',
#   'Grocery & Gourmet Food': 'Food & Health',
#   'Specialty Diets': 'Food & Health',
#   'Wine': 'Food & Health',
#   'AmazonFresh': 'Food & Health',
#   'Subscribe & Save': 'Food & Health',
#   'Prime Pantry': 'Food & Health',
#   'Amazon Elements': 'Food & Health',

#   'Toys, Kids & Baby': 'Kids & Toys',
#   'Toys & Games': 'Kids & Toys',
#   'Baby': 'Kids & Toys',
#   'Video Games for Kids': 'Kids & Toys',
#   'Amazon Mom': 'Kids & Toys',
#   'Baby Registry': 'Kids & Toys',
#   'Kids’ Birthdays': 'Kids & Toys',
#   'For Girls': 'Kids & Toys',
#   'For Boys': 'Kids & Toys',
#   'For Baby': 'Kids & Toys',

#   'Clothing, Shoes & Jewelry': 'Clothes & Accessories',
#   'Women': 'Clothes & Accessories',
#   'Men': 'Clothes & Accessories',
#   'Girls': 'Clothes & Accessories',
#   'Boys': 'Clothes & Accessories',
#   'Baby': 'Clothes & Accessories',
#   'Luggage': 'Clothes & Accessories',

#   'Sports & Outdoors': 'Sports & Outdoors',
#   'Athletic Clothing': 'Sports & Outdoors',
#   'Exercise & Fitness': 'Sports & Outdoors',
#   'Hunting & Fishing': 'Sports & Outdoors',
#   'Team Sports': 'Sports & Outdoors',
#   'Fan Shop': 'Sports & Outdoors',
#   'Golf': 'Sports & Outdoors',
#   'Leisure Sports & Game Room': 'Sports & Outdoors',
#   'Sports Collectibles': 'Sports & Outdoors',
#   'All Sports & Fitness': 'Sports & Outdoors',
#   'Camping & Hiking': 'Sports & Outdoors',
#   'Cycling': 'Sports & Outdoors',
#   'Outdoor Clothing': 'Sports & Outdoors',
#   'Scooters, Skateboards & Skates': 'Sports & Outdoors',
#   'Water Sports': 'Sports & Outdoors',
#   'Winter Sports': 'Sports & Outdoors',
#   'Climbing': 'Sports & Outdoors',
#   'Accessories': 'Sports & Outdoors',
#   'All Outdoor Recreation': 'Sports & Outdoors',

#   'Automotive & Industrial': 'Other',
#   'Automotive Parts & Accessories': 'Other',
#   'Automotive Tools & Equipment': 'Other',
#   'Car/Vehicle Electronics & GPS': 'Other',
#   'Tires & Wheels': 'Other',
#   'Motorcycle & Powersports': 'Other',
#   'Industrial Supplies': 'Other',
#   'Lab & Scientific': 'Other',
#   'Janitorial': 'Other',
#   'Safety': 'Other',

#   'Gift Cards': 'Other',
# }

# EBAY_TOP_MAP = {
#   'Antiques': 'Home & Office',
#   'Art': 'Home & Office',
#   'Baby': 'Kids & Toys',
#   'Books': 'Music & Media',
#   'Business & Industrial': 'Home & Office',
#   'Cameras & Photo': 'Electronics',
#   'Cell Phones & Accessories': 'Electronics',
#   'Clothing, Shoes & Accessories': 'Clothes & Accessories',
#   'Coins & Paper Money': 'Other',
#   'Collectibles': 'Other',
#   'Computers/Tablets & Networking': 'Electronics',
#   'Consumer Electronics': 'Electronics',
#   'Crafts': 'Home & Office',
#   'Dolls & Bears': 'Kids & Toys',
#   'DVDs & Movies': 'Music & Media',
#   'eBay Motors': 'Other',
#   'Entertainment Memorabilia': 'Other',
#   'Gift Cards & Coupons': 'Other',
#   'Health & Beauty': 'Food & Health',
#   'Home & Garden': 'Home & Office',
#   'Jewelry & Watches': 'Clothes & Accessories',
#   'Music': 'Music & Media',
#   'Musical Instruments & Gear': 'Music & Media',
#   'Pet Supplies': 'Home & Office',
#   'Pottery & Glass': 'Home & Office',
#   'Real Estate': 'Home & Office',
#   'Specialty Services': 'Sports & Outdoors',
#   'Sporting Goods': 'Sports & Outdoors',
#   'Sports Mem, Cards & Fan Shop': 'Sports & Outdoors',
#   'Stamps': 'Home & Office',
#   'Tickets & Experiences': 'Other',
#   'Toys & Hobbies': 'Kids & Toys',
#   'Travel': 'Other',
#   'Video Games & Consoles': 'Music & Media',
#   'Everything Else': 'Other'
# }

# categorize = (web_taxonomy, site) ->
#     if site is 'Amazon'
#         category = AMAZON_TOP_MAP[web_taxonomy]
#         return category or 'Other'
#     else if site is 'ebay'
#         category = EBAY_TOP_MAP[web_taxonomy]
#         return category or 'Other'
#     else
#         return 'Clothes & Accessories'

# Categories.remove({})
# Subcategories.remove({})

# Items.find().forEach (item) ->
#     category = categorize(item.web_taxonomy[0], item.site)
#     filter_name = classify category

#     id = Categories.findOne {name: category, uid: item.uid}
#     if not id
#         Categories.insert {
#             name: category
#             uid: item.uid
#             filter_name: classify(category)
#             count: 1
#         }
#     else
#         Categories.update(id, {$inc: {count: 1}})

#     if item.web_taxonomy[1]
#         id2 = Subcategories.findOne {name: item.web_taxonomy[1], uid: item.uid}
#         if not id2
#             Subcategories.insert {
#                 super_category: category
#                 uid: item.uid
#                 name: item.web_taxonomy[1]
#                 filter_name: classify(item.web_taxonomy[1])
#                 count: 1
#             }
#         else
#             Subcategories.update id2, {$inc: {count: 2}}

#     Items.update(item, {$set: {category: category, filter_name: filter_name}})
    

# Categories.find().forEach (category) ->
#     matching = Items.find({category: category.name, uid: category.uid}).fetch()
#     if matching.length is 0
#         Categories.remove category
#     else
#         ids = []

# Items.find().forEach (item) ->
#     if item.filter_band
#         Items.update item, {$set: {filter_brand: item.filter_band, filter_band: undefined}}
#     if item.site is 'amazon.com'
#         Items.update item, {$set: {site: 'Amazon'}}
#     if item.site is 'ebay.com'
#         Items.update item, {$set: {site: 'ebay'}}
#     if item.site is 'store.nike.com'
#         Items.update item, {$set: {site: 'Nike Store'}}
#     if item.site and not Sites.findOne({name: item.site, uid: item.uid})
#         Sites.insert({name: item.site, uid: item.uid})

# Sites.find().forEach (site) ->
#     if site.name is 'amazon.com'
#         Sites.update site, {$set: {name: 'Amazon'}}
#     if site.name is 'ebay.com'
#         Sites.update site, {$set: {name: 'ebay'}}
#     if site.name is 'store.nike.com'
#         Sites.update site, {$set: {name: 'Nike Store'}}


# smtp =
#     username: 'no-reply@breadcrumbs.ninja'
#     password: 'brown2town'
#     server:   'smtp.gmail.com'
#     port: 25

# process.env.MAIL_URL = 'smtp://' + encodeURIComponent(smtp.username) + ':' + encodeURIComponent(smtp.password) + '@' + encodeURIComponent(smtp.server) + ':' + smtp.port;    

# Email.send
#     from: 'no-reply@breadcrumbs.ninja'
#     to: 'tsunami70875@gmail.com'
#     subject: 'this is a test'
#     text: 'testing'



# Subcategories.find().forEach (category) ->
#     if category.super_category.name?
#         Subcategories.update category, {$set: { super_category: category.super_category.name }}

# Subcategories.remove({})
# Brands.remove({})
# Items.find().forEach (item) ->
#     if item.web_taxonomy
#         subcategories = [classify(subcat) for subcat in item.web_taxonomy[1..]][0]
#         Items.update item, {$set: {subcategories: subcategories, filter_brand: classify(item.brand)}}
#         main_subcategory = item.web_taxonomy[1]
#         if not Subcategories.findOne { super_category: item.category, name: main_subcategory, uid: item.uid }
#             Subcategories.insert { super_category: item.category, uid: item.uid, name: main_subcategory, filter_name: classify(main_subcategory)}                
                
#     if item.brand and not Brands.findOne { brand: item.brand, super_category: item.category, uid: item.uid, filter_brand: classify(item.brand) }
#         Brands.insert { brand: item.brand, super_category: item.category, uid: item.uid, filter_brand: classify(item.brand) }

# reClassify = () ->
#     Items.find().forEach (item) ->
#         # item.filter_name = classify item.category
#         if item.subcategories
#             # for index in [0...item.subcategories.length]
#                 # item.subcategories[index] = classify(item.subcategories[index])
#             item.subcategories = item.subcategories
#         Items.update item._id, item

#     Categories.find().forEach (category) ->
#         Categories.update category, {$set: { filter_name: classify(category.filter_name) }}

#     Subcategories.find().forEach (category) ->
#         Subcategories.update category, {$set: { filter_name: classify(category.filter_name) }}

# reClassify()

# 4/10/2015 Comment this all out after you've restarted the server once!

# Categories.remove({})

# Items.find().forEach (item) ->
#     web_taxonomy = item.web_taxonomy[1..] if item.web_taxonomy
#     if web_taxonomy
#         for subcat in web_taxonomy
#             if not Subcategories.findOne { super_category: item.category, name: subcat, uid: item.uid }
#                 Subcategories.insert { super_category: item.category, uid: item.uid, name: subcat, filter_name: classify(subcat) }

#         subcategories = [classify(subcat) for subcat in item.web_taxonomy[1..]]

#         category = item.web_taxonomy[0]
#         filter_name = classify item.category
#         Items.update item, {$set: {subcategories: subcategories, category: category, filter_name: filter_name}}

#         category = Categories.findOne {uid: item.uid, name: item.category}
#         if category
#             Categories.update category, {$push: { items: item._id }}
#         else
#             new_category = 
#                 name: item.category
#                 uid: item.uid
#                 items: [item._id]
#                 filter_name: item.filter_name
#             Categories.insert new_category

    # if not Sites.findOne {name: item.site, uid: item.uid}
    #     Sites.insert({name: item.site, uid: item.uid})


# Items.find().forEach (item) ->
#
#
# # 4/2/2015
# Items.find().forEach (item) ->
#   if item.web_taxonomy?
#     done = false
#     Categories.find({uid: item.uid}).forEach (category) ->
#       [sufficient, not_matched] = matchKeywords(item.web_taxonomy, category.keywords)
#       if sufficient and not done
#         console.log('Matched to category ' + category.name + '.')
#         console.log(category.keywords)
#         console.log(item.web_taxonomy)
#         Items.update item, {$set: {category: category.name, filter_name: classify(category.name)}}
#         # Categories.update category, {$push: {
#         #                                     keywords: {$each: not_matched},
#         #                                     items: item._id}}
#         done = true
#     if not done
#       new_category =
#         name: item.web_taxonomy[item.web_taxonomy.length - 1]
#         keywords: item.web_taxonomy
#         uid: item.uid
#         items: [item._id]
#       console.log('Creating new category: ' + new_category.name)
#       Items.update item, {$set: {category: new_category.name, filter_name: classify(new_category.name)}}
#       Categories.insert new_category
#   else
#     # no keywords
#     done = false
#     Categories.find({uid: item.uid}).forEach (category) ->
#       matched = matchSingleName(item.name, category.keywords)
#       if matched and not done
#         console.log('Matched to category ' + category.name + '.')
#         console.log(category.keywords)
#         console.log(item.name)
#         Items.update item, {$set: {category: category.name, filter_name: classify(category.name)}}
#         # Categories.update category, {$push: {items: item._id}}
#         done = true
#     if not done
#       # this'll be complex...
#       new_category =
#         name: item.name
#         keywords: []
#         uid: item.uid
#         items: [item._id]
#       console.log('Creating new category: ' + new_category.name)
#       Items.update item, {$set: {category: new_category.name, filter_name: classify(new_category.name)}}
#       Categories.insert new_category
#
# Categories.find().forEach (category) ->
#   Categories.update category, {$set: {filter_name: classify(category.name)}}